<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>buildstock_query.helpers API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>buildstock_query.helpers</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from concurrent.futures import Future
from pyathena.sqlalchemy.base import AthenaDialect
from pyathena.pandas.result_set import AthenaPandasResultSet
import datetime
import pickle
import os
import pandas as pd
from typing import Literal, TYPE_CHECKING

if TYPE_CHECKING:
    from buildstock_query.schema.utilities import MappedColumn  # noqa: F401


KWH2MBTU = 0.003412141633127942
MBTU2KWH = 293.0710701722222


class CachedFutureDf(Future):
    def __init__(self, df: pd.DataFrame, *args, **kwargs) -&gt; None:
        super().__init__(*args, **kwargs)
        self.df = df
        self.set_result(self.df)

    def running(self) -&gt; Literal[False]:
        return False

    def done(self) -&gt; Literal[True]:
        return True

    def cancelled(self) -&gt; Literal[False]:
        return False

    def result(self, timeout=None) -&gt; pd.DataFrame:
        return self.df

    def as_pandas(self) -&gt; pd.DataFrame:
        return self.df


class AthenaFutureDf:
    def __init__(self, db_future: Future) -&gt; None:
        self.future = db_future

    def cancel(self) -&gt; bool:
        return self.future.cancel()

    def running(self) -&gt; bool:
        return self.future.running()

    def done(self) -&gt; bool:
        return self.future.done()

    def cancelled(self) -&gt; bool:
        return self.future.cancelled()

    def result(self, timeout=None) -&gt; AthenaPandasResultSet:
        return self.future.result()

    def as_pandas(self) -&gt; pd.DataFrame:
        return self.future.as_pandas()  # type: ignore # mypy doesn&#39;t know about AthenaPandasResultSet


class COLOR:
    YELLOW = &#39;\033[93m&#39;
    RED = &#39;\033[91m&#39;
    GREEN = &#39;\033[92m&#39;
    END = &#39;\033[0m&#39;


def print_r(text):  # print in Red
    print(f&#34;{COLOR.RED}{text}{COLOR.END}&#34;)


def print_y(text):  # print in Yellow
    print(f&#34;{COLOR.YELLOW}{text}{COLOR.END}&#34;)


def print_g(text):  # print in Green
    print(f&#34;{COLOR.GREEN}{text}{COLOR.END}&#34;)


class UnSupportedTypeException(Exception):
    pass


class CustomCompiler(AthenaDialect().statement_compiler):  # type: ignore

    @staticmethod
    def render_literal(obj):
        from buildstock_query.schema.utilities import MappedColumn  # noqa: F811
        if isinstance(obj, (int, float)):
            return str(obj)
        elif isinstance(obj, str):
            return &#34;&#39;%s&#39;&#34; % obj.replace(&#34;&#39;&#34;, &#34;&#39;&#39;&#34;)
        elif isinstance(obj, (datetime.datetime)):
            return &#34;timestamp &#39;%s&#39;&#34; % str(obj).replace(&#34;&#39;&#34;, &#34;&#39;&#39;&#34;)
        elif isinstance(obj, list):
            return CustomCompiler.get_array_string(obj)
        elif isinstance(obj, tuple):
            return f&#34;({&#39;, &#39;.join([CustomCompiler.render_literal(v) for v in obj])})&#34;
        elif isinstance(obj, MappedColumn):
            keys = list(obj.mapping_dict.keys())
            values = list(obj.mapping_dict.values())
            if isinstance(obj.key, tuple):
                indexing_str = f&#34;({&#39;, &#39;.join(tuple(obj.bsq._compile(source) for source in obj.key))})&#34;
            else:
                indexing_str = obj.bsq._compile(obj.key)

            return f&#34;MAP({CustomCompiler.render_literal(keys)}, &#34; +\
                   f&#34;{CustomCompiler.render_literal(values)})[{indexing_str}]&#34;
        else:
            raise UnSupportedTypeException(f&#34;Unsupported type {type(obj)} for literal {obj}&#34;)

    @staticmethod
    def get_array_string(array):
        # rewrite to break into multiple arrays joined by CONCAT if the number of elements is &gt; 254
        if len(array) &gt; 254:
            array_list = [&#34;ARRAY[&#34; + &#39;, &#39;.join([CustomCompiler.render_literal(v) for v in array[i:i+254]]) + &#34;]&#34;
                          for i in range(0, len(array), 254)]
            return &#34;CONCAT(&#34; + &#39;, &#39;.join(array_list) + &#34;)&#34;
        else:
            return f&#34;ARRAY[{&#39;, &#39;.join([CustomCompiler.render_literal(v) for v in array])}]&#34;

    def render_literal_value(self, obj, type_):
        from buildstock_query.schema.utilities import MappedColumn  # noqa: F811
        if isinstance(obj, (datetime.datetime, list, tuple, MappedColumn)):
            return CustomCompiler.render_literal(obj)

        return super(CustomCompiler, self).render_literal_value(obj, type_)


class DataExistsException(Exception):
    def __init__(self, message, existing_data=None):
        super(DataExistsException, self).__init__(message)
        self.existing_data = existing_data


def save_pickle(path, obj):
    with open(path, &#34;wb&#34;) as f:
        pickle.dump(obj, f)


def load_pickle(path):
    if not os.path.exists(path):
        raise FileNotFoundError(f&#34;File {path} not found for loading table&#34;)
    with open(path, &#34;rb&#34;) as f:
        return pickle.load(f)


def read_csv(csv_file_path, **kwargs) -&gt; pd.DataFrame:
    default_na_values = pd._libs.parsers.STR_NA_VALUES
    df = pd.read_csv(csv_file_path, na_values=list(default_na_values - {&#34;None&#34;}), keep_default_na=False, **kwargs)
    return df</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="buildstock_query.helpers.load_pickle"><code class="name flex">
<span>def <span class="ident">load_pickle</span></span>(<span>path)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def load_pickle(path):
    if not os.path.exists(path):
        raise FileNotFoundError(f&#34;File {path} not found for loading table&#34;)
    with open(path, &#34;rb&#34;) as f:
        return pickle.load(f)</code></pre>
</details>
</dd>
<dt id="buildstock_query.helpers.print_g"><code class="name flex">
<span>def <span class="ident">print_g</span></span>(<span>text)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def print_g(text):  # print in Green
    print(f&#34;{COLOR.GREEN}{text}{COLOR.END}&#34;)</code></pre>
</details>
</dd>
<dt id="buildstock_query.helpers.print_r"><code class="name flex">
<span>def <span class="ident">print_r</span></span>(<span>text)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def print_r(text):  # print in Red
    print(f&#34;{COLOR.RED}{text}{COLOR.END}&#34;)</code></pre>
</details>
</dd>
<dt id="buildstock_query.helpers.print_y"><code class="name flex">
<span>def <span class="ident">print_y</span></span>(<span>text)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def print_y(text):  # print in Yellow
    print(f&#34;{COLOR.YELLOW}{text}{COLOR.END}&#34;)</code></pre>
</details>
</dd>
<dt id="buildstock_query.helpers.read_csv"><code class="name flex">
<span>def <span class="ident">read_csv</span></span>(<span>csv_file_path, **kwargs) ‑> pandas.core.frame.DataFrame</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def read_csv(csv_file_path, **kwargs) -&gt; pd.DataFrame:
    default_na_values = pd._libs.parsers.STR_NA_VALUES
    df = pd.read_csv(csv_file_path, na_values=list(default_na_values - {&#34;None&#34;}), keep_default_na=False, **kwargs)
    return df</code></pre>
</details>
</dd>
<dt id="buildstock_query.helpers.save_pickle"><code class="name flex">
<span>def <span class="ident">save_pickle</span></span>(<span>path, obj)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def save_pickle(path, obj):
    with open(path, &#34;wb&#34;) as f:
        pickle.dump(obj, f)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="buildstock_query.helpers.AthenaFutureDf"><code class="flex name class">
<span>class <span class="ident">AthenaFutureDf</span></span>
<span>(</span><span>db_future: concurrent.futures._base.Future)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class AthenaFutureDf:
    def __init__(self, db_future: Future) -&gt; None:
        self.future = db_future

    def cancel(self) -&gt; bool:
        return self.future.cancel()

    def running(self) -&gt; bool:
        return self.future.running()

    def done(self) -&gt; bool:
        return self.future.done()

    def cancelled(self) -&gt; bool:
        return self.future.cancelled()

    def result(self, timeout=None) -&gt; AthenaPandasResultSet:
        return self.future.result()

    def as_pandas(self) -&gt; pd.DataFrame:
        return self.future.as_pandas()  # type: ignore # mypy doesn&#39;t know about AthenaPandasResultSet</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="buildstock_query.helpers.AthenaFutureDf.as_pandas"><code class="name flex">
<span>def <span class="ident">as_pandas</span></span>(<span>self) ‑> pandas.core.frame.DataFrame</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def as_pandas(self) -&gt; pd.DataFrame:
    return self.future.as_pandas()  # type: ignore # mypy doesn&#39;t know about AthenaPandasResultSet</code></pre>
</details>
</dd>
<dt id="buildstock_query.helpers.AthenaFutureDf.cancel"><code class="name flex">
<span>def <span class="ident">cancel</span></span>(<span>self) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def cancel(self) -&gt; bool:
    return self.future.cancel()</code></pre>
</details>
</dd>
<dt id="buildstock_query.helpers.AthenaFutureDf.cancelled"><code class="name flex">
<span>def <span class="ident">cancelled</span></span>(<span>self) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def cancelled(self) -&gt; bool:
    return self.future.cancelled()</code></pre>
</details>
</dd>
<dt id="buildstock_query.helpers.AthenaFutureDf.done"><code class="name flex">
<span>def <span class="ident">done</span></span>(<span>self) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def done(self) -&gt; bool:
    return self.future.done()</code></pre>
</details>
</dd>
<dt id="buildstock_query.helpers.AthenaFutureDf.result"><code class="name flex">
<span>def <span class="ident">result</span></span>(<span>self, timeout=None) ‑> pyathena.pandas.result_set.AthenaPandasResultSet</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def result(self, timeout=None) -&gt; AthenaPandasResultSet:
    return self.future.result()</code></pre>
</details>
</dd>
<dt id="buildstock_query.helpers.AthenaFutureDf.running"><code class="name flex">
<span>def <span class="ident">running</span></span>(<span>self) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def running(self) -&gt; bool:
    return self.future.running()</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="buildstock_query.helpers.COLOR"><code class="flex name class">
<span>class <span class="ident">COLOR</span></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class COLOR:
    YELLOW = &#39;\033[93m&#39;
    RED = &#39;\033[91m&#39;
    GREEN = &#39;\033[92m&#39;
    END = &#39;\033[0m&#39;</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="buildstock_query.helpers.COLOR.END"><code class="name">var <span class="ident">END</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="buildstock_query.helpers.COLOR.GREEN"><code class="name">var <span class="ident">GREEN</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="buildstock_query.helpers.COLOR.RED"><code class="name">var <span class="ident">RED</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="buildstock_query.helpers.COLOR.YELLOW"><code class="name">var <span class="ident">YELLOW</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</dd>
<dt id="buildstock_query.helpers.CachedFutureDf"><code class="flex name class">
<span>class <span class="ident">CachedFutureDf</span></span>
<span>(</span><span>df: pandas.core.frame.DataFrame, *args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Represents the result of an asynchronous computation.</p>
<p>Initializes the future. Should not be called by clients.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class CachedFutureDf(Future):
    def __init__(self, df: pd.DataFrame, *args, **kwargs) -&gt; None:
        super().__init__(*args, **kwargs)
        self.df = df
        self.set_result(self.df)

    def running(self) -&gt; Literal[False]:
        return False

    def done(self) -&gt; Literal[True]:
        return True

    def cancelled(self) -&gt; Literal[False]:
        return False

    def result(self, timeout=None) -&gt; pd.DataFrame:
        return self.df

    def as_pandas(self) -&gt; pd.DataFrame:
        return self.df</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>concurrent.futures._base.Future</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="buildstock_query.helpers.CachedFutureDf.as_pandas"><code class="name flex">
<span>def <span class="ident">as_pandas</span></span>(<span>self) ‑> pandas.core.frame.DataFrame</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def as_pandas(self) -&gt; pd.DataFrame:
    return self.df</code></pre>
</details>
</dd>
<dt id="buildstock_query.helpers.CachedFutureDf.cancelled"><code class="name flex">
<span>def <span class="ident">cancelled</span></span>(<span>self) ‑> Literal[False]</span>
</code></dt>
<dd>
<div class="desc"><p>Return True if the future was cancelled.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def cancelled(self) -&gt; Literal[False]:
    return False</code></pre>
</details>
</dd>
<dt id="buildstock_query.helpers.CachedFutureDf.done"><code class="name flex">
<span>def <span class="ident">done</span></span>(<span>self) ‑> Literal[True]</span>
</code></dt>
<dd>
<div class="desc"><p>Return True if the future was cancelled or finished executing.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def done(self) -&gt; Literal[True]:
    return True</code></pre>
</details>
</dd>
<dt id="buildstock_query.helpers.CachedFutureDf.result"><code class="name flex">
<span>def <span class="ident">result</span></span>(<span>self, timeout=None) ‑> pandas.core.frame.DataFrame</span>
</code></dt>
<dd>
<div class="desc"><p>Return the result of the call that the future represents.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>timeout</code></strong></dt>
<dd>The number of seconds to wait for the result if the future
isn't done. If None, then there is no limit on the wait time.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>The result of the call that the future represents.</p>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>CancelledError</code></dt>
<dd>If the future was cancelled.</dd>
<dt><code>TimeoutError</code></dt>
<dd>If the future didn't finish executing before the given
timeout.</dd>
<dt><code>Exception</code></dt>
<dd>If the call raised then that exception will be raised.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def result(self, timeout=None) -&gt; pd.DataFrame:
    return self.df</code></pre>
</details>
</dd>
<dt id="buildstock_query.helpers.CachedFutureDf.running"><code class="name flex">
<span>def <span class="ident">running</span></span>(<span>self) ‑> Literal[False]</span>
</code></dt>
<dd>
<div class="desc"><p>Return True if the future is currently executing.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def running(self) -&gt; Literal[False]:
    return False</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="buildstock_query.helpers.CustomCompiler"><code class="flex name class">
<span>class <span class="ident">CustomCompiler</span></span>
<span>(</span><span>dialect, statement, cache_key=None, column_keys=None, for_executemany=False, linting=symbol('NO_LINTING'), **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Default implementation of :class:<code>.Compiled</code>.</p>
<p>Compiles :class:<code>_expression.ClauseElement</code> objects into SQL strings.</p>
<p>Construct a new :class:<code>.SQLCompiler</code> object.</p>
<p>:param dialect: :class:<code>.Dialect</code> to be used</p>
<p>:param statement: :class:<code>_expression.ClauseElement</code> to be compiled</p>
<p>:param column_keys:
a list of column names to be compiled into an
INSERT or UPDATE statement.</p>
<p>:param for_executemany: whether INSERT / UPDATE statements should
expect that they are to be invoked in an "executemany" style,
which may impact how the statement will be expected to return the
values of defaults and autoincrement / sequences and similar.
Depending on the backend and driver in use, support for retrieving
these values may be disabled which means SQL expressions may
be rendered inline, RETURNING may not be rendered, etc.</p>
<p>:param kwargs: additional keyword arguments to be consumed by the
superclass.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class CustomCompiler(AthenaDialect().statement_compiler):  # type: ignore

    @staticmethod
    def render_literal(obj):
        from buildstock_query.schema.utilities import MappedColumn  # noqa: F811
        if isinstance(obj, (int, float)):
            return str(obj)
        elif isinstance(obj, str):
            return &#34;&#39;%s&#39;&#34; % obj.replace(&#34;&#39;&#34;, &#34;&#39;&#39;&#34;)
        elif isinstance(obj, (datetime.datetime)):
            return &#34;timestamp &#39;%s&#39;&#34; % str(obj).replace(&#34;&#39;&#34;, &#34;&#39;&#39;&#34;)
        elif isinstance(obj, list):
            return CustomCompiler.get_array_string(obj)
        elif isinstance(obj, tuple):
            return f&#34;({&#39;, &#39;.join([CustomCompiler.render_literal(v) for v in obj])})&#34;
        elif isinstance(obj, MappedColumn):
            keys = list(obj.mapping_dict.keys())
            values = list(obj.mapping_dict.values())
            if isinstance(obj.key, tuple):
                indexing_str = f&#34;({&#39;, &#39;.join(tuple(obj.bsq._compile(source) for source in obj.key))})&#34;
            else:
                indexing_str = obj.bsq._compile(obj.key)

            return f&#34;MAP({CustomCompiler.render_literal(keys)}, &#34; +\
                   f&#34;{CustomCompiler.render_literal(values)})[{indexing_str}]&#34;
        else:
            raise UnSupportedTypeException(f&#34;Unsupported type {type(obj)} for literal {obj}&#34;)

    @staticmethod
    def get_array_string(array):
        # rewrite to break into multiple arrays joined by CONCAT if the number of elements is &gt; 254
        if len(array) &gt; 254:
            array_list = [&#34;ARRAY[&#34; + &#39;, &#39;.join([CustomCompiler.render_literal(v) for v in array[i:i+254]]) + &#34;]&#34;
                          for i in range(0, len(array), 254)]
            return &#34;CONCAT(&#34; + &#39;, &#39;.join(array_list) + &#34;)&#34;
        else:
            return f&#34;ARRAY[{&#39;, &#39;.join([CustomCompiler.render_literal(v) for v in array])}]&#34;

    def render_literal_value(self, obj, type_):
        from buildstock_query.schema.utilities import MappedColumn  # noqa: F811
        if isinstance(obj, (datetime.datetime, list, tuple, MappedColumn)):
            return CustomCompiler.render_literal(obj)

        return super(CustomCompiler, self).render_literal_value(obj, type_)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>pyathena.sqlalchemy.base.AthenaStatementCompiler</li>
<li>sqlalchemy.sql.compiler.SQLCompiler</li>
<li>sqlalchemy.sql.compiler.Compiled</li>
</ul>
<h3>Static methods</h3>
<dl>
<dt id="buildstock_query.helpers.CustomCompiler.get_array_string"><code class="name flex">
<span>def <span class="ident">get_array_string</span></span>(<span>array)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def get_array_string(array):
    # rewrite to break into multiple arrays joined by CONCAT if the number of elements is &gt; 254
    if len(array) &gt; 254:
        array_list = [&#34;ARRAY[&#34; + &#39;, &#39;.join([CustomCompiler.render_literal(v) for v in array[i:i+254]]) + &#34;]&#34;
                      for i in range(0, len(array), 254)]
        return &#34;CONCAT(&#34; + &#39;, &#39;.join(array_list) + &#34;)&#34;
    else:
        return f&#34;ARRAY[{&#39;, &#39;.join([CustomCompiler.render_literal(v) for v in array])}]&#34;</code></pre>
</details>
</dd>
<dt id="buildstock_query.helpers.CustomCompiler.render_literal"><code class="name flex">
<span>def <span class="ident">render_literal</span></span>(<span>obj)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def render_literal(obj):
    from buildstock_query.schema.utilities import MappedColumn  # noqa: F811
    if isinstance(obj, (int, float)):
        return str(obj)
    elif isinstance(obj, str):
        return &#34;&#39;%s&#39;&#34; % obj.replace(&#34;&#39;&#34;, &#34;&#39;&#39;&#34;)
    elif isinstance(obj, (datetime.datetime)):
        return &#34;timestamp &#39;%s&#39;&#34; % str(obj).replace(&#34;&#39;&#34;, &#34;&#39;&#39;&#34;)
    elif isinstance(obj, list):
        return CustomCompiler.get_array_string(obj)
    elif isinstance(obj, tuple):
        return f&#34;({&#39;, &#39;.join([CustomCompiler.render_literal(v) for v in obj])})&#34;
    elif isinstance(obj, MappedColumn):
        keys = list(obj.mapping_dict.keys())
        values = list(obj.mapping_dict.values())
        if isinstance(obj.key, tuple):
            indexing_str = f&#34;({&#39;, &#39;.join(tuple(obj.bsq._compile(source) for source in obj.key))})&#34;
        else:
            indexing_str = obj.bsq._compile(obj.key)

        return f&#34;MAP({CustomCompiler.render_literal(keys)}, &#34; +\
               f&#34;{CustomCompiler.render_literal(values)})[{indexing_str}]&#34;
    else:
        raise UnSupportedTypeException(f&#34;Unsupported type {type(obj)} for literal {obj}&#34;)</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="buildstock_query.helpers.CustomCompiler.render_literal_value"><code class="name flex">
<span>def <span class="ident">render_literal_value</span></span>(<span>self, obj, type_)</span>
</code></dt>
<dd>
<div class="desc"><p>Render the value of a bind parameter as a quoted literal.</p>
<p>This is used for statement sections that do not accept bind parameters
on the target driver/database.</p>
<p>This should be implemented by subclasses using the quoting services
of the DBAPI.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def render_literal_value(self, obj, type_):
    from buildstock_query.schema.utilities import MappedColumn  # noqa: F811
    if isinstance(obj, (datetime.datetime, list, tuple, MappedColumn)):
        return CustomCompiler.render_literal(obj)

    return super(CustomCompiler, self).render_literal_value(obj, type_)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="buildstock_query.helpers.DataExistsException"><code class="flex name class">
<span>class <span class="ident">DataExistsException</span></span>
<span>(</span><span>message, existing_data=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Common base class for all non-exit exceptions.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class DataExistsException(Exception):
    def __init__(self, message, existing_data=None):
        super(DataExistsException, self).__init__(message)
        self.existing_data = existing_data</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
</dd>
<dt id="buildstock_query.helpers.UnSupportedTypeException"><code class="flex name class">
<span>class <span class="ident">UnSupportedTypeException</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Common base class for all non-exit exceptions.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class UnSupportedTypeException(Exception):
    pass</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="buildstock_query" href="index.html">buildstock_query</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="two-column">
<li><code><a title="buildstock_query.helpers.load_pickle" href="#buildstock_query.helpers.load_pickle">load_pickle</a></code></li>
<li><code><a title="buildstock_query.helpers.print_g" href="#buildstock_query.helpers.print_g">print_g</a></code></li>
<li><code><a title="buildstock_query.helpers.print_r" href="#buildstock_query.helpers.print_r">print_r</a></code></li>
<li><code><a title="buildstock_query.helpers.print_y" href="#buildstock_query.helpers.print_y">print_y</a></code></li>
<li><code><a title="buildstock_query.helpers.read_csv" href="#buildstock_query.helpers.read_csv">read_csv</a></code></li>
<li><code><a title="buildstock_query.helpers.save_pickle" href="#buildstock_query.helpers.save_pickle">save_pickle</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="buildstock_query.helpers.AthenaFutureDf" href="#buildstock_query.helpers.AthenaFutureDf">AthenaFutureDf</a></code></h4>
<ul class="two-column">
<li><code><a title="buildstock_query.helpers.AthenaFutureDf.as_pandas" href="#buildstock_query.helpers.AthenaFutureDf.as_pandas">as_pandas</a></code></li>
<li><code><a title="buildstock_query.helpers.AthenaFutureDf.cancel" href="#buildstock_query.helpers.AthenaFutureDf.cancel">cancel</a></code></li>
<li><code><a title="buildstock_query.helpers.AthenaFutureDf.cancelled" href="#buildstock_query.helpers.AthenaFutureDf.cancelled">cancelled</a></code></li>
<li><code><a title="buildstock_query.helpers.AthenaFutureDf.done" href="#buildstock_query.helpers.AthenaFutureDf.done">done</a></code></li>
<li><code><a title="buildstock_query.helpers.AthenaFutureDf.result" href="#buildstock_query.helpers.AthenaFutureDf.result">result</a></code></li>
<li><code><a title="buildstock_query.helpers.AthenaFutureDf.running" href="#buildstock_query.helpers.AthenaFutureDf.running">running</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="buildstock_query.helpers.COLOR" href="#buildstock_query.helpers.COLOR">COLOR</a></code></h4>
<ul class="">
<li><code><a title="buildstock_query.helpers.COLOR.END" href="#buildstock_query.helpers.COLOR.END">END</a></code></li>
<li><code><a title="buildstock_query.helpers.COLOR.GREEN" href="#buildstock_query.helpers.COLOR.GREEN">GREEN</a></code></li>
<li><code><a title="buildstock_query.helpers.COLOR.RED" href="#buildstock_query.helpers.COLOR.RED">RED</a></code></li>
<li><code><a title="buildstock_query.helpers.COLOR.YELLOW" href="#buildstock_query.helpers.COLOR.YELLOW">YELLOW</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="buildstock_query.helpers.CachedFutureDf" href="#buildstock_query.helpers.CachedFutureDf">CachedFutureDf</a></code></h4>
<ul class="">
<li><code><a title="buildstock_query.helpers.CachedFutureDf.as_pandas" href="#buildstock_query.helpers.CachedFutureDf.as_pandas">as_pandas</a></code></li>
<li><code><a title="buildstock_query.helpers.CachedFutureDf.cancelled" href="#buildstock_query.helpers.CachedFutureDf.cancelled">cancelled</a></code></li>
<li><code><a title="buildstock_query.helpers.CachedFutureDf.done" href="#buildstock_query.helpers.CachedFutureDf.done">done</a></code></li>
<li><code><a title="buildstock_query.helpers.CachedFutureDf.result" href="#buildstock_query.helpers.CachedFutureDf.result">result</a></code></li>
<li><code><a title="buildstock_query.helpers.CachedFutureDf.running" href="#buildstock_query.helpers.CachedFutureDf.running">running</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="buildstock_query.helpers.CustomCompiler" href="#buildstock_query.helpers.CustomCompiler">CustomCompiler</a></code></h4>
<ul class="">
<li><code><a title="buildstock_query.helpers.CustomCompiler.get_array_string" href="#buildstock_query.helpers.CustomCompiler.get_array_string">get_array_string</a></code></li>
<li><code><a title="buildstock_query.helpers.CustomCompiler.render_literal" href="#buildstock_query.helpers.CustomCompiler.render_literal">render_literal</a></code></li>
<li><code><a title="buildstock_query.helpers.CustomCompiler.render_literal_value" href="#buildstock_query.helpers.CustomCompiler.render_literal_value">render_literal_value</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="buildstock_query.helpers.DataExistsException" href="#buildstock_query.helpers.DataExistsException">DataExistsException</a></code></h4>
</li>
<li>
<h4><code><a title="buildstock_query.helpers.UnSupportedTypeException" href="#buildstock_query.helpers.UnSupportedTypeException">UnSupportedTypeException</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>